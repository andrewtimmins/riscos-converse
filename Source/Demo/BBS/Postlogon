{
    goto main_menu

    /* Main Menu */
    label main_menu
    if ansi == `1` goto ansi_main_menu
    goto plain_main_menu

    label ansi_main_menu
    cls
    fgbg 7 0
    goto show_greeting

    label plain_main_menu
    print `\r\n----------------------------------------\r\n`
    goto show_greeting

    label show_greeting
    /* Time-based greeting */
    if %{hour} < 12 goto greet_morning
    if %{hour} < 17 goto greet_afternoon
    goto greet_evening

    label greet_morning
    set greeting `Good morning`
    goto show_menu

    label greet_afternoon
    set greeting `Good afternoon`
    goto show_menu

    label greet_evening
    set greeting `Good evening`
    goto show_menu

    label show_menu
    doing `Main Menu`

    /* Show ANSI header or plain header */
    if ansi == `1` goto show_ansi_header
    print `\r\n        MAIN MENU\r\n`
    print `----------------------------------------\r\n`
    goto after_header

    label show_ansi_header
    type `<Converse$Dir>.BBS.ANSI.Header`
    goto after_header

    label after_header

    /* Christmas special - only coloured for ANSI */
    if %{day} == 25 && %{month} == 12 goto christmas_banner
    goto normal_banner

    label christmas_banner
    if ansi == `1` goto christmas_ansi
    print `\r\n*** Merry Christmas! ***\r\n`
    goto after_banner

    label christmas_ansi
    fgbg 1 0
    print `\r\n*** Merry Christmas! ***\r\n`
    fgbg 7 0
    goto after_banner

    label normal_banner
    /* New Year greeting for first week of January */
    if %{month} == 1 && %{day} <= 7 goto newyear_banner
    goto after_banner

    label newyear_banner
    if ansi == `1` goto newyear_ansi
    print `\r\n*** Happy New Year %{year}! ***\r\n`
    goto after_banner

    label newyear_ansi
    fgbg 3 0
    print `\r\n*** Happy New Year %{year}! ***\r\n`
    fgbg 7 0
    goto after_banner

    label after_banner
    print `\r\n%{greeting}! Today is %{date}, the time is %{time}.\r\n`

    /* User status block */
    if %{registered} == 1 goto show_registered_status
    if ansi == `1` goto guest_ansi
    print `You are browsing as a guest. Why not register for more features?\r\n`
    goto after_user_status

    label guest_ansi
    fgbg 3 0
    print `You are browsing as a guest. Why not register for more features?\r\n`
    fgbg 7 0
    goto after_user_status

    label show_registered_status
    print `You have access level %{accesslevel}.`
    if %{sysop} == 1 goto show_sysop_thanks
    print ` Thank you for being a registered user!\r\n`
    goto after_user_status

    label show_sysop_thanks
    print ` Welcome back, Sysop!\r\n`

    label after_user_status

    type `<Converse$Dir>.BBS.Menus.MainMenu`

    print `\r\nEnter choice (1-5): `
    prompt choice char echo

    if choice == `1` goto ansi_artwork
    if choice == `2` goto connection_status
    if choice == `3` goto demo_message
    if choice == `4` goto whos_online
    if choice == `5` goto arcbbs_doors
    if choice == `6` goto riscbbs_doors
    if choice == `F` || choice == `f` goto filebase_menu
    if choice == `M` || choice == `m` goto messagebase_menu
    if choice == `S` || choice == `s` goto chat_sysop
    if choice == `X` || choice == `x` goto end_session
    if choice == `R` || choice == `r` goto random_game
    if choice == `C` || choice == `c` goto sysop_chat

    print `\r\nUnknown selection '%{choice}', please try again.\r\n`
    goto main_menu

    label arcbbs_doors
    script `<Converse$Dir>.BBS.ARCbbs`

    label riscbbs_doors
    script `<Converse$Dir>.BBS.RiscBBS`

    label filebase_menu
    script `<Converse$Dir>.BBS.Filebase`

    label messagebase_menu
    script `<Converse$Dir>.BBS.Messagebase`

    label ansi_artwork
    doing `ANSI Artwork`
    if ansi == `1` goto show_ansi_art
    print `\r\n[ANSI artwork requires an ANSI terminal]\r\n`
    anykey temp
    goto main_menu

    label show_ansi_art
    cls
    fgbg 7 0
    type `<Converse$Dir>.BBS.Art.Demo`
    anykey temp
    goto main_menu

    label connection_status
    doing `Connection status`
    print `\r\n[Live Status]\r\n`
    print `Current line: %{line}\r\n`
    print `  Time now  : %{time}\r\n`
    print `  Date today: %{date}\r\n`
    print `  Terminal  : `
    if ansi == `1` goto term_ansi
    print `TTY (plain text)\r\n`
    goto after_term
    label term_ansi
    print `ANSI (color/cursor)\r\n`
    label after_term
    print `  Day of week: `
    if %{dayofweek} == 0 goto dow_sun
    if %{dayofweek} == 1 goto dow_mon
    if %{dayofweek} == 2 goto dow_tue
    if %{dayofweek} == 3 goto dow_wed
    if %{dayofweek} == 4 goto dow_thu
    if %{dayofweek} == 5 goto dow_fri
    goto dow_sat

    label dow_sun
    print `Sunday\r\n`
    goto after_dow
    label dow_mon
    print `Monday\r\n`
    goto after_dow
    label dow_tue
    print `Tuesday\r\n`
    goto after_dow
    label dow_wed
    print `Wednesday\r\n`
    goto after_dow
    label dow_thu
    print `Thursday\r\n`
    goto after_dow
    label dow_fri
    print `Friday\r\n`
    goto after_dow
    label dow_sat
    print `Saturday\r\n`
    goto after_dow

    label after_dow
    print `  Logged in : `
    if %{registered} == 1 goto show_logged_in
    print `No (Guest)\r\n`
    goto after_login_status
    label show_logged_in
    print `Yes (Access Level: %{accesslevel})\r\n`
    label after_login_status

    call lineinfo
    anykey temp
    goto main_menu

    label demo_message
    doing `Demo message`
    if ansi == `1` goto demo_ansi
    print `\r\nHello world. This is a demo message.\r\n`
    goto demo_done
    label demo_ansi
    fgbg 2 0
    print `\r\nHello world. This is a demo message.\r\n`
    fgbg 7 0
    label demo_done
    anykey temp
    goto main_menu

    label whos_online
    doing `Viewing online users`
    if ansi == `1` goto online_ansi
    print `\r\n           Online Users\r\n`
    print `----------------------------------------\r\n`
    goto show_online
    label online_ansi
    cls
    fgbg 3 6
    print `\r\n                      Online Users                    \r\n`
    fgbg 7 0
    label show_online
    online
    anykey temp
    goto main_menu

    /* Random number guessing game */
    label random_game
    doing `Playing number game`
    if ansi == `1` goto game_ansi
    print `\r\n=== Guess the Number ===\r\n`
    goto game_start
    label game_ansi
    cls
    fgbg 7 0
    print `\r\n=== Guess the Number ===\r\n`
    label game_start
    print `I'm thinking of a number between 1 and 10...\r\n\r\n`
    random secret 1 10
    set attempts 0

    label game_loop
    add attempts attempts 1
    print `Attempt %{attempts}: Enter your guess (1-10): `
    prompt guess line echo

    strlen guesslen guess
    if guesslen == 0 goto game_quit

    if guess == %{secret} goto game_win
    if guess > %{secret} goto guess_high
    print `Too low! Try again.\r\n`
    goto game_loop

    label guess_high
    print `Too high! Try again.\r\n`
    goto game_loop

    label game_win
    if ansi == `1` goto win_ansi
    print `\r\nCorrect! You got it in %{attempts} attempts!\r\n`
    goto win_done
    label win_ansi
    fgbg 2 0
    print `\r\nCorrect! You got it in %{attempts} attempts!\r\n`
    fgbg 7 0
    label win_done
    anykey temp
    goto main_menu

    label game_quit
    print `\r\nQuitting game...\r\n`
    anykey temp
    goto main_menu

    label chat_sysop
    /* Only allow chat during business hours on weekdays */
    if %{dayofweek} == 0 || %{dayofweek} == 6 goto chat_weekend
    if %{hour} < 9 || %{hour} >= 17 goto chat_closed
    goto chat_open

    label chat_weekend
    print `\r\nSorry, sysop chat is not available on weekends.\r\n`
    anykey temp
    goto main_menu

    label chat_closed
    print `\r\nSorry, sysop chat is only available 9am-5pm on weekdays.\r\n`
    anykey temp
    goto main_menu

    label chat_open
    doing `Chatting with Sysop...`
    call arcbbsdoor 101 `<Converse$Dir>.BBS.Doors.ARCbbs.!Natter -door %{line}`
    goto main_menu

    label sysop_chat
    doing `Chatting with Sysop...`
    sysopchat

    label end_session
    logoff
    return
}
