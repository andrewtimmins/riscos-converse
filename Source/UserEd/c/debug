/*
 * UserEd debug implementation
 * Uses Reporter module for output
 */

#include <stdio.h>
#include <stdarg.h>
#include <string.h>
#include "kernel.h"
#include "debug.h"

#define SWI_Report_Text0 0x54C80

void debug_printf(const char *fmt, ...)
{
    char buffer[512];
    va_list args;
    _kernel_swi_regs regs;

    va_start(args, fmt);
    vsnprintf(buffer, sizeof(buffer), fmt, args);
    va_end(args);

    /* Remove trailing newlines for Reporter */
    {
        int len = strlen(buffer);
        while (len > 0 && (buffer[len-1] == '\n' || buffer[len-1] == '\r')) {
            buffer[--len] = '\0';
        }
    }

    regs.r[0] = (int)buffer;
    _kernel_swi(SWI_Report_Text0, &regs, &regs);
}
