/*
 * Telnet BBS Door Server
 * Copyright (c) Andrew Timmins, 2023. All rights reserved.
 *
*/

#ifndef MAIN_H
#define MAIN_H

    #include <time.h>

    /* Desk Includes */
    #include "C:Desk.Core.h"
    #include "C:Desk.Menu.h"
    #include "C:Desk.Dialog.h"
    #include "C:Desk.Dialog2.h"

    /* Defines */
    #define iconbar_menu_proginfo    0
    #define iconbar_menu_systeminfo  1
    #define iconbar_menu_usereditor  2
    #define iconbar_menu_quit        3

    #define Telnet_EOF               236
    #define Telnet_SUSP              237
    #define Telnet_ABORT             238
    #define Telnet_EOR               239
    #define Telnet_SE                240
    #define Telnet_NOP               241
    #define Telnet_DM                242
    #define Telnet_BRK               243
    #define Telnet_IP                244
    #define Telnet_AO                245
    #define Telnet_AYT               246
    #define Telnet_EC                247
    #define Telnet_EL                248
    #define Telnet_GA                249
    #define Telnet_SB                250
    #define Telnet_WILL              251
    #define Telnet_WONT              252
    #define Telnet_DO                253
    #define Telnet_DONT              254
    #define Telnet_IAC               255

    #define Option_BINARY            0
    #define Option_ECHO              1
    #define Option_SUPRESS           3
    #define Option_STATUS            5
    #define Option_TIMING            6
    #define Option_TERMTYPE          24
    #define Option_WINDOWSIZE        31
    #define Option_TERMSPEED         32
    #define Option_LFLOW             33
    #define Option_LINEMODE          34
    #define Option_ENVIRON           36

    #define Resolver_GetHost         0x66001

    /* Variables */
    struct wimp_components
    {
        Desk_bool quit;
        Desk_icon_handle iconbar_icon_handle;
        Desk_menu_ptr iconbar_menu_handle;
    };

    typedef struct
    {
        char name[256];
        char sysop[256];
        char contact[256];
        char hostname[256];
        int port;
        int timeout;
        char botstopper[4];
        char needlogin[4];
        char closed[4];
        char pager[4];
        char ftnmail[4];
        char anykey[256];
        char chatstart[256];
        char chatend[256];
        char prelogon[256];
        char postlogon[256];
        char logoff[256];
        char welcome[256];
        char newuser[256];
        char timeup[256];
        char lockedout[256];
        char closedsys[256];
        char aftermail[256];
    } system_components;

    typedef struct
    {
        char line[4];
        char enabled[4];
        char botstopper[128];
        char hello[256];
        int socket;
        struct sockaddr to;
        int connectedtime;
        clock_t last_activity;
        long timer;
        int resolved;
        char remote[128];
    } line_components;

    static Desk_dialog2_block *proginfo_window;
    static Desk_dialog2_block *systeminfo_window;
    static Desk_window_handle main_window;
    
    static char app_version ("0.01");
    static char app_compiled[]=__DATE__" at "__TIME__;
    static char small_app_compiled[]=__DATE__" ["__TIME__"];

    static char waiting_user[100];
    static char user_activity[100];

    static char error_bind[100];
    static char error_listen[100];
    static char error_busy[100];
    
    static char error_cantfindsystemconfig[100];
    static char error_cantfindlineconfig[100];
    static char error_toomanylines[100];
    static char error_nolinesdefined[100];

    static system_components system_configuration[1];

    static line_components line_configuration[32];
    static int line_configurations=0;
    static int line_task_handles[32];

    static int listening_socket = 0;
    static int active_sockets = 0;
    static fd_set is_socket_ready;
    static struct timeval socket_timeout;
    static char socket_buffer[256] = "";
#endif
