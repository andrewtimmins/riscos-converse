/* ******************************************************************************************************************************************************** */
/* Web Server - Template Header                                                                                                                             */
/* ******************************************************************************************************************************************************** */

#ifndef TEMPLATE_H
#define TEMPLATE_H

#include <stddef.h>
#include "session.h"

/* Template tags */
#define TEMPLATE_TAG_FILEBASE       "{{filebase}}"
#define TEMPLATE_TAG_MESSAGEBASE    "{{messagebase}}"
#define TEMPLATE_TAG_BBSNAME        "{{bbsname}}"
#define TEMPLATE_TAG_USERNAME       "{{username}}"
#define TEMPLATE_TAG_REALNAME       "{{realname}}"
#define TEMPLATE_TAG_LOGGEDIN       "{{loggedin}}"
#define TEMPLATE_TAG_LOGGEDOUT      "{{loggedout}}"
#define TEMPLATE_TAG_LOGINFORM      "{{loginform}}"
#define TEMPLATE_TAG_UPLOADFORM     "{{uploadform}}"

/* Set current session context for template processing
 * session: pointer to session, or NULL if not logged in
 */
void template_set_session(WEB_SESSION *session);

/* Process template content, expanding template tags
 * content: input content buffer
 * content_len: length of input content
 * out_len: receives length of output (can be NULL)
 * Returns: newly allocated buffer with expanded content, or NULL on error
 * Caller must free() the returned buffer
 */
char *template_process(const char *content, long content_len, long *out_len);

/* Check if content contains any template tags
 * Returns 1 if tags found, 0 if not
 */
int template_has_tags(const char *content, long content_len);

/* Generate HTML listing of all filebases
 * Returns: newly allocated buffer with HTML, or NULL on error
 * Caller must free() the returned buffer
 */
char *template_generate_filebase_listing(long *out_len);

/* Generate HTML listing of all messagebases
 * Returns: newly allocated buffer with HTML, or NULL on error
 * Caller must free() the returned buffer
 */
char *template_generate_messagebase_listing(long *out_len);

#endif /* TEMPLATE_H */
