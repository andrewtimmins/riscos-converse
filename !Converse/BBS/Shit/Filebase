{
    goto filebase_menu

    /* Filebase Menu */
    label filebase_menu
    cls
    fgbg 7 0
    doing `Filebase Menu`
    type `<Converse$Dir>.BBS.ANSI.Header`
    type `<Converse$Dir>.BBS.Menus.FileMenu`

    /* Show current selection status */
    if %{filebaseid} == 0 goto fb_no_selection
    if %{filebaseareaid} == 0 goto fb_base_only
    fg 6
    print `\r\nCurrent: %{filebasename} > %{filebaseareaname}\r\n`
    fg 7
    goto fb_show_prompt
    label fb_base_only
    fg 6
    print `\r\nCurrent: %{filebasename} (all areas)\r\n`
    fg 7
    goto fb_show_prompt
    label fb_no_selection
    fg 3
    print `\r\nNo filebase selected\r\n`
    fg 7
    label fb_show_prompt

    print `\r\nEnter choice (1-7, X): `
    prompt choice char echo

    if choice == `1` goto list_filebases
    if choice == `2` goto list_fileareas
    if choice == `3` goto select_filebase
    if choice == `4` goto select_area
    if choice == `5` goto list_files
    if choice == `6` goto download_file
    if choice == `7` goto upload_file
    if choice == `X` goto main_menu
    if choice == `x` goto main_menu

    print `\r\nUnknown selection '%{choice}', please try again.\r\n`
    goto filebase_menu

    label list_filebases
    doing `Listing filebases...`
    filebase list
    anykey temp
    goto filebase_menu


    label list_fileareas
    doing `Listing areas...`
    filebase areas
    anykey temp
    goto filebase_menu

    label select_filebase
    print `\r\nEnter filebase ID: `
    prompt fb_id line echo
    filebase select `%{fb_id}`
    anykey temp
    goto filebase_menu

    label select_area
    print `\r\nEnter area ID (0=all): `
    prompt area_id line echo
    filebase area `%{area_id}`
    anykey temp
    goto filebase_menu

    label list_files
    doing `Listing files...`
    filebase files
    anykey temp
    goto filebase_menu

    label download_file
    print `\r\nEnter file ID to download: `
    prompt file_id line echo
    print `\r\nSelect protocol:\r\n`
    print `  [1] XMODEM (checksum)\r\n`
    print `  [2] XMODEM-CRC\r\n`
    print `  [3] XMODEM-1K\r\n`
    print `  [4] YMODEM\r\n`
    print `  [5] YMODEM-G (streaming)\r\n`
    print `  [6] ZMODEM (recommended)\r\n`
    print `\r\nChoice: `
    prompt proto_choice char echo
    if proto_choice == `1` goto dl_xmodem
    if proto_choice == `2` goto dl_xmodem_crc
    if proto_choice == `3` goto dl_xmodem_1k
    if proto_choice == `4` goto dl_ymodem
    if proto_choice == `5` goto dl_ymodem_g
    if proto_choice == `6` goto dl_zmodem
    print `\r\nUsing default (ZMODEM)...\r\n`
    goto dl_zmodem

    label dl_xmodem
    doing `Downloading file...`
    sendfile `%{file_id}` xmodem
    goto download_done

    label dl_xmodem_crc
    doing `Downloading file...`
    sendfile `%{file_id}` xmodem-crc
    goto download_done

    label dl_xmodem_1k
    doing `Downloading file...`
    sendfile `%{file_id}` xmodem-1k
    goto download_done

    label dl_ymodem
    doing `Downloading file...`
    sendfile `%{file_id}` ymodem
    goto download_done

    label dl_ymodem_g
    doing `Downloading file...`
    sendfile `%{file_id}` ymodem-g
    goto download_done

    label dl_zmodem
    doing `Downloading file...`
    sendfile `%{file_id}` zmodem
    goto download_done

    label download_done
    doing `Filebase Menu`
    anykey temp
    goto filebase_menu

    label upload_file
    print `\r\nEnter filename for upload: `
    prompt upload_name line echo
    print `\r\nSelect protocol:\r\n`
    print `  [1] XMODEM (checksum)\r\n`
    print `  [2] XMODEM-CRC\r\n`
    print `  [3] XMODEM-1K\r\n`
    print `  [4] YMODEM\r\n`
    print `  [5] YMODEM-G (streaming)\r\n`
    print `  [6] ZMODEM (recommended)\r\n`
    print `\r\nChoice: `
    prompt ul_proto char echo
    if ul_proto == `1` goto ul_xmodem
    if ul_proto == `2` goto ul_xmodem_crc
    if ul_proto == `3` goto ul_xmodem_1k
    if ul_proto == `4` goto ul_ymodem
    if ul_proto == `5` goto ul_ymodem_g
    if ul_proto == `6` goto ul_zmodem
    print `\r\nUsing default (ZMODEM)...\r\n`
    goto ul_zmodem

    label ul_xmodem
    doing `Uploading file...`
    receivefile `%{upload_name}` xmodem
    goto upload_done

    label ul_xmodem_crc
    doing `Uploading file...`
    receivefile `%{upload_name}` xmodem-crc
    goto upload_done

    label ul_xmodem_1k
    doing `Uploading file...`
    receivefile `%{upload_name}` xmodem-1k
    goto upload_done

    label ul_ymodem
    doing `Uploading file...`
    receivefile `%{upload_name}` ymodem
    goto upload_done

    label ul_ymodem_g
    doing `Uploading file...`
    receivefile `%{upload_name}` ymodem-g
    goto upload_done

    label ul_zmodem
    doing `Uploading file...`
    receivefile `%{upload_name}` zmodem
    goto upload_done

    label upload_done
    doing `Filebase Menu`
    anykey temp
    goto filebase_menu

    label main_menu
    script `<Converse$Dir>.BBS.Postlogon`
}