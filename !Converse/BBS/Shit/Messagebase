{
    goto messagebase_menu

    /* Messagebase Menu */
    label messagebase_menu
    cls
    fgbg 7 0
    doing `Messagebase Menu`
    type `<Converse$Dir>.BBS.ANSI.Header`
    type `<Converse$Dir>.BBS.Menus.MsgMenu`

    /* Show current selection status */
    if %{messagebaseid} == 0 goto mb_no_selection
    if %{messagebaseareaid} == 0 goto mb_base_only
    fg 6
    print `\r\nCurrent: %{messagebasename} > %{messagebaseareaname}\r\n`
    fg 7
    goto mb_show_prompt
    label mb_base_only
    fg 6
    print `\r\nCurrent: %{messagebasename} (all areas)\r\n`
    fg 7
    goto mb_show_prompt
    label mb_no_selection
    fg 3
    print `\r\nNo messagebase selected\r\n`
    fg 7
    label mb_show_prompt

    print `\r\nEnter choice (1-7, X): `
    prompt choice char echo

    if choice == `1` goto list_messagebases
    if choice == `2` goto list_areas
    if choice == `3` goto select_messagebase
    if choice == `4` goto select_area
    if choice == `5` goto list_messages
    if choice == `6` goto read_messages
    if choice == `7` goto post_message
    if choice == `X` goto main_menu
    if choice == `x` goto main_menu

    print `\r\nUnknown selection '%{choice}', please try again.\r\n`
    goto messagebase_menu

    label list_messagebases
    doing `Listing messagebases...`
    messagebase list
    anykey temp
    goto messagebase_menu

    label list_areas
    doing `Listing areas...`
    messagebase areas
    anykey temp
    goto messagebase_menu

    label select_messagebase
    print `\r\nEnter messagebase ID: `
    prompt mb_id line echo
    messagebase select `%{mb_id}`
    anykey temp
    goto messagebase_menu

    label select_area
    print `\r\nEnter area ID (0=all): `
    prompt area_id line echo
    messagebase area `%{area_id}`
    anykey temp
    goto messagebase_menu

    label list_messages
    doing `Listing messages...`
    messagebase messages
    anykey temp
    goto messagebase_menu

    label read_messages
    print `\r\nEnter message ID (0=first): `
    prompt msg_id line echo
    messagebase read `%{msg_id}`
    anykey temp
    goto messagebase_menu

    label post_message
    doing `Composing message...`
    messagebase post
    anykey temp
    goto messagebase_menu

    label main_menu
    script `<Converse$Dir>.BBS.Postlogon`
}
